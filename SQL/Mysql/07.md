## MySQL 笔记-07

> ##
> ### 目录
> 1. 概述
> 2. 基本查询语句
> 3. 单表查询
> 4. 聚合函数查询
> 5. 连接查询
> 6. 子查询
> 7. 合并查询结果
> 8. 定义表和字段别名
> 9. 正则表达式查询
> ##

---

#### 1. 概述

数据查询是指从数据库中获取所需要的数据。数据查询是数据库操作中最常用，也是最重要的操作。通过不同的查询方式可以获得不同的数据。用户可以根据自己对数据的需求使用不同的查询方式。在MySQL中是使用SELECT语句来查询数据的。

--- 

#### 2. 基本查询语句
```
SELECT selection_list FROM 表名
WHERE primary_constraint
GROUP BY grouping_columns
ORDER BY sorting_columns
HAVING secondary_constraint
LIMIT count
```

例如
```
# 查询一个表数据
select * from users;

# 查询表中多个字段
select name, age from users;

# 从一个或多个表中获取数据(全连接)
select users.name, users.age, blogs.star, blogs.comment from users, blogs;

# where子句
select id, user from users, blogs
where users.id = blogs.id && users.user = "joe";
```

查询数据库中的数据时，如果数据涉及中文字符串，有可能在输出时出现乱码，那么在最后执行查询操作之前，通过"set names"语句设置其编码格式，然后再输出中文字符串时就不会出现乱码了。例如 set names "gb2312";

上面例子中 users.id = blogs.id的方式将表users和blogs连接起来，叫做等同连接；如果不使用的话，结果是两个表的笛卡尔积，叫做全连接。

---

#### 3. 单表查询

单表查询是指从一张表中查询所需要的数据，所有查询操作都比较简单。

<b>查询所有字段</b>
```
SELECT * FROM 表;
```

<b>查询指定字段</b>
```
SELECT 字段名 FROM 表;
```

<b>查询指定数据</b>

使用的where子句，配合比较运算符（>, <, in, not in...）
```
SELECT * FROM 表 WHERE 条件;
```

例如
```
select * from users where name like "jo%";
```

<b>带关键字IN的查询</b>

关键字IN可以判断某个字段的值是否在指定的集合中。
```
SELECT * FROM 表 WHERE 条件 [NOT] IN(元素1, 元素2, ...);
```

<b>带关键字BETWEEN AND的范围查询</b>

关键字BETWEEN AND可以判断某个字段的值是否在指定的范围内。
```
SELECT * FROM 表 WHERE 条件 [NOT] BETWEEN 取值1 AND 取值2;
```

例如查询age在18～23岁之间的大学生
```
select * from users where age between 18 and 23;
```

<b>带LIKE的字符匹配查询</b>

LIKE属于较常用的比较运算符，可以通过它实现模糊查询。它有两种通配符"%"和"_"。

+ "%"可以匹配一个或多个字符，可以代表任意长度的字符串，长度可以为0。
>
+ "_"只匹配一个字符。

例如
```
# 可以匹配user为joe、jjoe、jjod等.
select * from users where user like "%o_";
```

<b>带关键字IS NULL查询</b>

关键字IS NULL可以用来判断字段的值是否为空值（NULL）。
```
SELECT * FROM 表 WHERE 条件 IS NULL;
```

<b>带关键字AND的查询</b>

关键字AND可以用来联合多个条件进行查询。
```
SELECT * FROM 表 WHERE 条件1 AND 条件2 [AND 条件3...]
```

例如查询name含joe且年龄在18到23岁且爱好在游泳、跑步之中一个的用户
```
select * from users where
name like "%joe%" and
age between 18 and 23 and
hobbit in ("swimming", "running");
```

<b>带关键字OR的查询</b>

OR也表示多条件查询，且满足其中一组条件即可，用法同AND

<b>用关键字DISTINCT的查询</b>

DISTINCT关键字可以去除查询结果中的重复记录
```
SELECT DISTINCT 字段名 FROM 表;
```

例如
```
# 去除了重名的记录
select distinct name from users;
```

<b>带关键字ORDER BY的查询</b>

使用关键字ORDER BY可以对查询的结果进行升序(ASC)或者降序(DESC)排列，默认ASC
```
SELECT * FROM 表 ORDER BY 字段名 [ASC|DESC]
```

<b>带关键字GROUP BY的查询</b>

使用关键字GROUP BY可以将数据划分到不同的组中，实现对记录进行分组查询。查询时，所查询的列必须包含在分组的列中，目的是使查询到的数据没有矛盾。

1.使用GROUP BY，单独使用group by查询结果只显示每组的一条记录。
```
select user, age from users group by user
```
结果如下，尽管表中有user=joe的多条记录，结果也只显示一条
|user|age|
|--|--|
|joe|23|
|sun|28|

2.使用GROUP BY与GROUP_CONCAT(字段)函数一起使用

group_concat函数可以将对应字段的所有结果都显示到一个字段上
```
SELECT 字段A, group_concat(字段B) FROM 表 GROUP BY 字段B
```

例如
```
select user, group_concat(age) from users group by age
```

结果
|user|group_concat(age)|
|--|--|
|joe|23,23|
|sun|28,28,28|

3.按多个字段进行分组

使用关键字GROUP BY也可以按多个字段进行分组。
```
SELECT 字段A,字段B,... FROM 表 GROUP BY 字段A,字段B
```

分组顺序按照左到右。

<b>带关键字LIMIT的查询</b>

LIMIT关键字用来控制结果显示的行数。
```
SELECT * FROM 表 LIMIT [offset,] counts
```

例如
```
# 从第1条数据开始返回5条记录
select * from users order by age desc limit 5

# 从第2条数据开始往后数5条返回
select * from users order by age desc limit 1, 5
```
