## 操作系统导论 - PART1 进程API

#### fork系统调用

系统调用fork用于创建新进程。示例
```
# nodejs demo/03/fork/fork.js
# python demo/03/fork/fork.py
```

其中pid表示进程描述符（process identifier）。

父进程获得的返回值是新创建子进程的PID，而子进程获得的返回值是0。而且CPU调度程序（scheduler）决定了某个时刻哪个进程被执行。这种不确定性会导致一些有趣的问题，特别是在多线程程序中（multi-threaded program）中。

---

#### wait系统调用

有时候父进程需要等待子进程执行完毕，需要由wait系统调用（或waitpid()）来便于我们控制进程。

调用示例
```
# nodejs demo/03/wait/wait.js
# python demo/03/wait/wait.py
```

---

#### exec系统调用

调用exec系统调用，可以让子进程执行与父进程不同的程序。

给定可执行程序的名称及参数后，exec会从可执行程序中加载代码和静态数据，并用它覆盖自己的代码段以及静态数据，堆栈及其他内存空间也会被重新初始化。然后操作系统执行该程序，将参数通过argv传递给该进程。因此，它并没有创建新进程，而是直接将当前运行的程序替换为不同的运行程序。子进程执行exec之后，几乎就像当前进程从未运行过exec的子程序一样，对exec的成功调用永远不会返回。

---

#### 做对事 Get it right

Lampson在他的著名论文“Hints for Computer Systems Design”中说过，“做对事（get it right）”。抽象和简化都不能替代做对事。有时你必须做正确的事，当你这样做时，总好过其他方案。有许多方式来设计创建进程的API，但fork和exec的组合既简单又强大。

---

#### UNIX管道

UNIX管道是通过pipe系统调用来实现的。一个进程的输出被链接到了一个**内核管道**上的**队列**，另一个进程的输入也被链接到了同一个管道上。因此，前一个进程的输出无缝地作为后一个进程的输入，许多命令可以用这种方式串联在一起，共同完成某项任务。例如``grep -O test test* | wc -l``,表示先显示匹配的文件里符合条件的字符串，然后再统计输出结果的行数并最终打印。

---

#### RTFM 阅读man手册

很多时候我们如果不清楚shell命令中这些系统调用都是什么意思的时候，需要用到man手册,例如
```
man wc
```
man手册是Unix系统中最原生的文档，它的出现甚早于网络。

---


#### 其他系统调用API

除了fork、exec、wait之外，在Unix中还有其他许多与进程交互的方式，比如通过kill来向进程发送信号(signal)，其中包括要求进程睡眠、终止或其他有用的指令。实际上，整个信号子系统提供了一套丰富的向进程传递外部事件的途径，包括接受和执行这些信号。

此外还有许多很有用的命令行工具。例如通过ps命令来查看在运行的进程，top命令来查看系统中进程消耗CPU或其他资源的情况。可以阅读man手册来了解它们。


